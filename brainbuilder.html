<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BrainBuilder ‚Äî The Brooklyn Project</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;600;700;800&family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --coral: #FF6B6B;
    --sunshine: #FFD93D;
    --sky: #6BC5FF;
    --mint: #6BCB77;
    --grape: #9B72CF;
    --peach: #FFB085;
    --rose: #FF8FAB;
    --bg: #FFFDF7;
    --bg-alt: #FFF3E0;
    --text: #3D3256;
    --text-light: #7A6B8A;
    --card-shadow: 0 6px 24px rgba(61,50,86,0.12);
    --radius: 20px;
  }

  body {
    font-family: 'Quicksand', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* === ANIMATED BACKGROUND BLOBS === */
  .bg-blobs {
    position: fixed;
    inset: 0;
    z-index: 0;
    overflow: hidden;
    pointer-events: none;
  }
  .blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.25;
    animation: blobFloat 12s ease-in-out infinite alternate;
  }
  .blob-1 { width: 420px; height: 420px; background: var(--sky); top: -80px; left: -100px; animation-delay: 0s; }
  .blob-2 { width: 350px; height: 350px; background: var(--sunshine); bottom: -60px; right: -80px; animation-delay: -4s; }
  .blob-3 { width: 300px; height: 300px; background: var(--mint); top: 40%; left: 60%; animation-delay: -8s; }
  .blob-4 { width: 260px; height: 260px; background: var(--rose); bottom: 20%; left: 10%; animation-delay: -2s; }

  @keyframes blobFloat {
    0% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(30px, -40px) scale(1.08); }
    100% { transform: translate(-20px, 20px) scale(0.95); }
  }

  /* === LAYOUT === */
  .app {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 24px 20px 60px;
  }

  /* === HEADER === */
  .header {
    text-align: center;
    margin-bottom: 8px;
  }
  .brand {
    font-family: 'Baloo 2', cursive;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--grape);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 2px;
  }
  .game-title {
    font-family: 'Baloo 2', cursive;
    font-size: 2.6rem;
    font-weight: 800;
    line-height: 1.1;
    background: linear-gradient(135deg, var(--coral), var(--grape), var(--sky));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .game-subtitle {
    font-size: 1rem;
    color: var(--text-light);
    font-weight: 500;
    margin-top: 2px;
  }

  /* === SCREENS === */
  .screen { display: none; }
  .screen.active { display: block; animation: fadeUp 0.5s ease; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* === WELCOME SCREEN === */
  .welcome-card {
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--card-shadow);
    padding: 40px 32px;
    text-align: center;
    margin-top: 20px;
    border: 3px solid transparent;
    background-image: linear-gradient(white, white), linear-gradient(135deg, var(--sunshine), var(--coral), var(--grape));
    background-origin: border-box;
    background-clip: padding-box, border-box;
  }
  .welcome-emoji {
    font-size: 4rem;
    margin-bottom: 12px;
    animation: bounce 2s ease-in-out infinite;
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-12px); }
  }
  .welcome-heading {
    font-family: 'Baloo 2', cursive;
    font-size: 1.7rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--text);
  }
  .welcome-text {
    font-size: 1rem;
    color: var(--text-light);
    line-height: 1.6;
    max-width: 480px;
    margin: 0 auto 28px;
  }
  .level-picker {
    display: flex;
    gap: 16px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .level-btn {
    flex: 1;
    min-width: 200px;
    max-width: 280px;
    padding: 28px 20px;
    border-radius: 18px;
    border: 3px solid transparent;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .level-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 15px;
    opacity: 0;
    transition: opacity 0.3s;
  }
  .level-btn:hover { transform: translateY(-4px) scale(1.03); }
  .level-btn:hover::before { opacity: 1; }
  .level-btn:active { transform: translateY(0) scale(0.98); }

  .level-k2 {
    background: linear-gradient(135deg, #FFF5E6, #FFE8CC);
    border-color: var(--peach);
  }
  .level-k2:hover { box-shadow: 0 8px 30px rgba(255,176,133,0.4); }
  .level-35 {
    background: linear-gradient(135deg, #EDE7FF, #DDD0FF);
    border-color: var(--grape);
  }
  .level-35:hover { box-shadow: 0 8px 30px rgba(155,114,207,0.35); }

  .level-emoji { font-size: 2.5rem; margin-bottom: 8px; }
  .level-label {
    font-family: 'Baloo 2', cursive;
    font-size: 1.3rem;
    font-weight: 700;
    display: block;
    margin-bottom: 4px;
  }
  .level-k2 .level-label { color: #D4782F; }
  .level-35 .level-label { color: #6B3FA0; }
  .level-desc {
    font-size: 0.85rem;
    color: var(--text-light);
    line-height: 1.4;
  }

  /* === GAME SCREEN === */
  .game-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 20px;
    padding: 16px 20px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 3px 12px rgba(61,50,86,0.08);
  }
  .game-bar-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .back-btn {
    background: none;
    border: 2px solid #E8E0F0;
    border-radius: 12px;
    padding: 8px 12px;
    cursor: pointer;
    font-size: 1.1rem;
    color: var(--text-light);
    transition: all 0.2s;
    font-family: 'Quicksand', sans-serif;
    font-weight: 600;
  }
  .back-btn:hover { border-color: var(--grape); color: var(--grape); }
  .round-label {
    font-family: 'Baloo 2', cursive;
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text);
  }
  .game-bar-right {
    display: flex;
    align-items: center;
    gap: 20px;
  }
  .stat {
    display: flex;
    align-items: center;
    gap: 6px;
    font-weight: 600;
    font-size: 0.95rem;
  }
  .stat-icon { font-size: 1.2rem; }
  .stat-val { color: var(--text); }

  .stars-display {
    display: flex;
    gap: 4px;
  }
  .star {
    font-size: 1.4rem;
    transition: all 0.3s ease;
    filter: grayscale(1) opacity(0.3);
  }
  .star.earned {
    filter: none;
    animation: starPop 0.4s ease;
  }
  @keyframes starPop {
    0% { transform: scale(0.5) rotate(-30deg); }
    60% { transform: scale(1.3) rotate(10deg); }
    100% { transform: scale(1) rotate(0); }
  }

  /* === PUZZLE AREA === */
  .puzzle-instruction {
    text-align: center;
    margin-bottom: 20px;
    padding: 16px 20px;
    background: white;
    border-radius: 16px;
    box-shadow: 0 3px 12px rgba(61,50,86,0.06);
  }
  .puzzle-instruction h2 {
    font-family: 'Baloo 2', cursive;
    font-size: 1.35rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 4px;
  }
  .puzzle-instruction p {
    font-size: 0.95rem;
    color: var(--text-light);
  }

  /* === PATTERN MATCH GAME === */
  .pattern-game {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
  }
  .pattern-sequence {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
    padding: 24px;
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--card-shadow);
    min-height: 100px;
  }
  .pattern-item {
    width: 70px;
    height: 70px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: 700;
    transition: all 0.3s;
    animation: popIn 0.4s ease backwards;
  }
  .pattern-item.question-mark {
    background: linear-gradient(135deg, #F0E6FF, #E0D0FF);
    border: 3px dashed var(--grape);
    color: var(--grape);
    font-family: 'Baloo 2', cursive;
    font-size: 2.2rem;
    animation: pulse 1.5s ease-in-out infinite;
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.08); }
  }
  @keyframes popIn {
    from { transform: scale(0) rotate(-15deg); opacity: 0; }
    to { transform: scale(1) rotate(0); opacity: 1; }
  }
  .pattern-arrow {
    font-size: 1.5rem;
    color: var(--text-light);
    opacity: 0.5;
  }

  .answer-choices {
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .answer-btn {
    width: 80px;
    height: 80px;
    border-radius: 18px;
    border: 3px solid #E8E0F0;
    background: white;
    cursor: pointer;
    font-size: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.25s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  }
  .answer-btn:hover {
    transform: translateY(-4px) scale(1.06);
    border-color: var(--sky);
    box-shadow: 0 8px 24px rgba(107,197,255,0.3);
  }
  .answer-btn:active { transform: scale(0.95); }
  .answer-btn.correct {
    border-color: var(--mint);
    background: linear-gradient(135deg, #E8F8EA, #D0F0D4);
    animation: correctPop 0.5s ease;
  }
  .answer-btn.wrong {
    border-color: var(--coral);
    background: linear-gradient(135deg, #FFE8E8, #FFD0D0);
    animation: shake 0.4s ease;
  }
  @keyframes correctPop {
    0% { transform: scale(1); }
    50% { transform: scale(1.15); }
    100% { transform: scale(1); }
  }
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-8px); }
    75% { transform: translateX(8px); }
  }

  /* === MEMORY MATCH GAME === */
  .memory-grid {
    display: grid;
    gap: 12px;
    justify-content: center;
    margin: 0 auto;
  }
  .memory-grid.grid-3x4 {
    grid-template-columns: repeat(4, 80px);
    max-width: 360px;
  }
  .memory-grid.grid-4x4 {
    grid-template-columns: repeat(4, 80px);
    max-width: 360px;
  }
  .memory-card {
    width: 80px;
    height: 90px;
    perspective: 600px;
    cursor: pointer;
  }
  .memory-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.5s ease;
    transform-style: preserve-3d;
  }
  .memory-card.flipped .memory-card-inner { transform: rotateY(180deg); }
  .memory-card.matched .memory-card-inner { transform: rotateY(180deg); }
  .memory-card.matched { animation: matchGlow 0.6s ease; }

  @keyframes matchGlow {
    0% { filter: brightness(1); }
    50% { filter: brightness(1.3) drop-shadow(0 0 12px rgba(107,203,119,0.6)); }
    100% { filter: brightness(1); }
  }

  .memory-front, .memory-back {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 14px;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  .memory-front {
    background: linear-gradient(145deg, var(--sky), var(--grape));
    color: white;
    font-family: 'Baloo 2', cursive;
    font-size: 1.6rem;
    font-weight: 700;
  }
  .memory-back {
    background: white;
    border: 3px solid #E8E0F0;
    transform: rotateY(180deg);
  }

  /* === SORTING GAME === */
  .sorting-game {
    display: flex;
    flex-direction: column;
    gap: 20px;
    align-items: center;
  }
  .sort-items {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .sort-item {
    padding: 14px 22px;
    border-radius: 16px;
    background: white;
    border: 3px solid #E8E0F0;
    cursor: grab;
    font-size: 1.1rem;
    font-weight: 600;
    font-family: 'Quicksand', sans-serif;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    transition: all 0.2s;
    user-select: none;
  }
  .sort-item:hover { transform: translateY(-3px); border-color: var(--sky); }
  .sort-item.selected {
    border-color: var(--grape);
    background: linear-gradient(135deg, #F0E6FF, #E0D0FF);
    transform: scale(1.05);
  }
  .sort-item.placed { opacity: 0.4; pointer-events: none; }

  .sort-buckets {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    justify-content: center;
    width: 100%;
  }
  .sort-bucket {
    flex: 1;
    min-width: 180px;
    max-width: 280px;
    min-height: 140px;
    border-radius: 18px;
    border: 3px dashed #D0C4E0;
    padding: 16px;
    text-align: center;
    transition: all 0.3s;
    cursor: pointer;
    background: rgba(255,255,255,0.7);
  }
  .sort-bucket:hover {
    border-color: var(--grape);
    background: rgba(240,230,255,0.5);
  }
  .sort-bucket.highlight {
    border-color: var(--sky);
    background: rgba(107,197,255,0.1);
  }
  .bucket-title {
    font-family: 'Baloo 2', cursive;
    font-size: 1.15rem;
    font-weight: 700;
    margin-bottom: 10px;
    color: var(--grape);
  }
  .bucket-items {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
  }
  .bucket-chip {
    padding: 6px 14px;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 600;
    background: white;
    border: 2px solid #E8E0F0;
    animation: popIn 0.3s ease;
  }
  .bucket-chip.correct-chip { border-color: var(--mint); background: #E8F8EA; }
  .bucket-chip.wrong-chip { border-color: var(--coral); background: #FFE8E8; }

  /* === ODD ONE OUT === */
  .odd-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
    gap: 14px;
    max-width: 520px;
    margin: 0 auto;
  }
  .odd-card {
    aspect-ratio: 1;
    border-radius: 18px;
    border: 3px solid #E8E0F0;
    background: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.8rem;
    box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    transition: all 0.25s;
  }
  .odd-card:hover {
    transform: translateY(-4px) scale(1.04);
    border-color: var(--sky);
  }
  .odd-card.correct {
    border-color: var(--mint);
    background: linear-gradient(135deg, #E8F8EA, #D0F0D4);
    animation: correctPop 0.5s ease;
  }
  .odd-card.wrong {
    border-color: var(--coral);
    background: linear-gradient(135deg, #FFE8E8, #FFD0D0);
    animation: shake 0.4s ease;
  }

  /* === FEEDBACK TOAST === */
  .feedback-toast {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    z-index: 100;
    padding: 24px 40px;
    border-radius: 24px;
    font-family: 'Baloo 2', cursive;
    font-size: 1.8rem;
    font-weight: 800;
    text-align: center;
    pointer-events: none;
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .feedback-toast.show { transform: translate(-50%, -50%) scale(1); }
  .feedback-toast.correct-toast {
    background: linear-gradient(135deg, var(--mint), #4CAF50);
    color: white;
    box-shadow: 0 12px 40px rgba(107,203,119,0.5);
  }
  .feedback-toast.wrong-toast {
    background: linear-gradient(135deg, var(--coral), #E53935);
    color: white;
    box-shadow: 0 12px 40px rgba(255,107,107,0.5);
  }
  .feedback-toast .toast-emoji { font-size: 2.4rem; display: block; margin-bottom: 4px; }

  /* === RESULTS SCREEN === */
  .results-card {
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--card-shadow);
    padding: 44px 32px;
    text-align: center;
    margin-top: 20px;
    border: 3px solid transparent;
    background-image: linear-gradient(white, white), linear-gradient(135deg, var(--sunshine), var(--mint), var(--sky));
    background-origin: border-box;
    background-clip: padding-box, border-box;
  }
  .results-emoji { font-size: 4.5rem; margin-bottom: 12px; }
  .results-heading {
    font-family: 'Baloo 2', cursive;
    font-size: 2rem;
    font-weight: 800;
    margin-bottom: 8px;
  }
  .results-stars {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin: 16px 0;
  }
  .results-stars .star { font-size: 2.4rem; }
  .results-stat-grid {
    display: flex;
    gap: 16px;
    justify-content: center;
    flex-wrap: wrap;
    margin: 24px 0;
  }
  .results-stat-box {
    padding: 16px 24px;
    border-radius: 14px;
    min-width: 120px;
  }
  .results-stat-box.score-box { background: linear-gradient(135deg, #E8F8EA, #D0F0D4); }
  .results-stat-box.time-box { background: linear-gradient(135deg, #E6F0FF, #D0E4FF); }
  .results-stat-num {
    font-family: 'Baloo 2', cursive;
    font-size: 2rem;
    font-weight: 800;
    color: var(--text);
  }
  .results-stat-label {
    font-size: 0.8rem;
    color: var(--text-light);
    font-weight: 600;
  }
  .results-message {
    font-size: 1rem;
    color: var(--text-light);
    line-height: 1.6;
    margin-bottom: 28px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
  .results-btns {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .btn-primary, .btn-secondary {
    padding: 14px 32px;
    border-radius: 14px;
    font-family: 'Baloo 2', cursive;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.25s;
    border: none;
  }
  .btn-primary {
    background: linear-gradient(135deg, var(--grape), #7C4DFF);
    color: white;
    box-shadow: 0 6px 20px rgba(155,114,207,0.4);
  }
  .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(155,114,207,0.5); }
  .btn-secondary {
    background: white;
    color: var(--grape);
    border: 2px solid var(--grape);
  }
  .btn-secondary:hover { background: #F8F0FF; transform: translateY(-3px); }

  /* === CONFETTI === */
  .confetti-container {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 99;
    overflow: hidden;
  }
  .confetti-piece {
    position: absolute;
    width: 10px;
    height: 10px;
    top: -20px;
    animation: confettiFall linear forwards;
  }
  @keyframes confettiFall {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
  }

  /* === RESPONSIVE === */
  @media (max-width: 600px) {
    .game-title { font-size: 2rem; }
    .pattern-item { width: 55px; height: 55px; font-size: 1.5rem; }
    .answer-btn { width: 64px; height: 64px; font-size: 1.6rem; }
    .memory-grid.grid-3x4, .memory-grid.grid-4x4 {
      grid-template-columns: repeat(4, 65px);
    }
    .memory-card { width: 65px; height: 75px; }
    .level-btn { min-width: 160px; padding: 22px 16px; }
    .game-bar { padding: 12px 14px; }
    .sort-bucket { min-width: 140px; }
  }
</style>
</head>
<body>

<div class="bg-blobs">
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>
  <div class="blob blob-3"></div>
  <div class="blob blob-4"></div>
</div>

<div class="app">
  <header class="header">
    <div class="brand">The Brooklyn Project</div>
    <h1 class="game-title">üß© BrainBuilder</h1>
    <p class="game-subtitle">Think. Match. Solve!</p>
  </header>

  <!-- WELCOME SCREEN -->
  <div id="welcome-screen" class="screen active">
    <div class="welcome-card">
      <div class="welcome-emoji">üß†</div>
      <h2 class="welcome-heading">Ready to exercise your brain?</h2>
      <p class="welcome-text">
        Play fun puzzles that build your critical thinking skills! Find patterns, match pairs, sort items, and spot the odd one out. Pick your level to start!
      </p>
      <div class="level-picker">
        <button class="level-btn level-k2" onclick="startGame('k2')">
          <div class="level-emoji">üå±</div>
          <span class="level-label">Grades K‚Äì2</span>
          <div class="level-desc">Shapes, colors, animals & simple patterns</div>
        </button>
        <button class="level-btn level-35" onclick="startGame('35')">
          <div class="level-emoji">üöÄ</div>
          <span class="level-label">Grades 3‚Äì5</span>
          <div class="level-desc">Numbers, categories, logic & tricky puzzles</div>
        </button>
      </div>
    </div>
  </div>

  <!-- GAME SCREEN -->
  <div id="game-screen" class="screen">
    <div class="game-bar">
      <div class="game-bar-left">
        <button class="back-btn" onclick="goHome()">‚Üê Home</button>
        <span class="round-label" id="round-label">Round 1 / 5</span>
      </div>
      <div class="game-bar-right">
        <div class="stars-display" id="stars-display">
          <span class="star">‚≠ê</span>
          <span class="star">‚≠ê</span>
          <span class="star">‚≠ê</span>
        </div>
        <div class="stat">
          <span class="stat-icon">üéØ</span>
          <span class="stat-val" id="score-val">0</span>
        </div>
        <div class="stat">
          <span class="stat-icon">‚è±</span>
          <span class="stat-val" id="time-val">0:00</span>
        </div>
      </div>
    </div>
    <div class="puzzle-instruction" id="puzzle-instruction">
      <h2 id="puzzle-title">What comes next?</h2>
      <p id="puzzle-desc">Look at the pattern and pick the missing piece!</p>
    </div>
    <div id="puzzle-area"></div>
  </div>

  <!-- RESULTS SCREEN -->
  <div id="results-screen" class="screen">
    <div class="results-card">
      <div class="results-emoji" id="results-emoji">üèÜ</div>
      <h2 class="results-heading" id="results-heading">Amazing Job!</h2>
      <div class="results-stars" id="results-stars"></div>
      <div class="results-stat-grid">
        <div class="results-stat-box score-box">
          <div class="results-stat-num" id="results-score">0</div>
          <div class="results-stat-label">Points</div>
        </div>
        <div class="results-stat-box time-box">
          <div class="results-stat-num" id="results-time">0:00</div>
          <div class="results-stat-label">Time</div>
        </div>
      </div>
      <p class="results-message" id="results-message">You're getting better every time!</p>
      <div class="results-btns">
        <button class="btn-primary" onclick="playAgain()">üîÑ Play Again</button>
        <button class="btn-secondary" onclick="goHome()">üè† Home</button>
      </div>
    </div>
  </div>
</div>

<!-- FEEDBACK TOAST -->
<div class="feedback-toast" id="feedback-toast"></div>
<div class="confetti-container" id="confetti-container"></div>

<script>
// ====== GAME STATE ======
let level = 'k2';
let currentRound = 0;
let totalRounds = 5;
let score = 0;
let timerInterval = null;
let startTime = 0;
let elapsedSeconds = 0;
let puzzles = [];
let locked = false;

// ====== PUZZLE DATA ======

// --- K-2 Emoji Patterns ---
const k2PatternSets = [
  { seq: ['üçé','üçä','üçé','üçä','üçé'], answer: 'üçä', choices: ['üçä','üçá','üçé','üçã'] },
  { seq: ['üî¥','üîµ','üî¥','üîµ','üî¥'], answer: 'üîµ', choices: ['üî¥','üîµ','üü°','üü¢'] },
  { seq: ['üê±','üê∂','üê±','üê∂','üê±'], answer: 'üê∂', choices: ['üê±','üê∞','üê∂','üêª'] },
  { seq: ['‚≠ê','‚≠ê','üåô','‚≠ê','‚≠ê'], answer: 'üåô', choices: ['‚≠ê','üåô','‚òÄÔ∏è','üí´'] },
  { seq: ['üåà','‚òÅÔ∏è','üåà','‚òÅÔ∏è','üåà'], answer: '‚òÅÔ∏è', choices: ['‚òÅÔ∏è','üåà','‚õÖ','üå§'] },
  { seq: ['üü¢','üü¢','üü°','üü¢','üü¢'], answer: 'üü°', choices: ['üü¢','üî¥','üü°','üîµ'] },
  { seq: ['üêü','üêü','üê†','üêü','üêü'], answer: 'üê†', choices: ['üêü','üê†','üê°','ü¶à'] },
  { seq: ['üå∏','üåº','üå∏','üåº','üå∏'], answer: 'üåº', choices: ['üå∏','üåº','üåπ','üåª'] },
];

// --- K-2 Odd One Out ---
const k2OddSets = [
  { items: ['üçé','üçê','üçä','üöó'], odd: 'üöó', hint: 'One is NOT a fruit!' },
  { items: ['üê±','üê∂','üê∞','üå≥'], odd: 'üå≥', hint: 'One is NOT an animal!' },
  { items: ['üî¥','üîµ','üü¢','‚≠ê'], odd: '‚≠ê', hint: 'One is NOT a circle!' },
  { items: ['üê†','üêü','ü¶à','ü¶Å'], odd: 'ü¶Å', hint: 'One does NOT live in water!' },
  { items: ['üöó','üöå','‚úàÔ∏è','üöé'], odd: '‚úàÔ∏è', hint: 'One does NOT drive on roads!' },
  { items: ['üçï','üçî','üåÆ','üìö'], odd: 'üìö', hint: 'One is NOT food!' },
];

// --- K-2 Memory Pairs ---
const k2MemoryEmojis = ['üê±','üê∂','ü¶ä','üê∏','üêù','üåà','üçé','‚≠ê','üå∏','üê†','ü¶ã','üåô'];

// --- 3-5 Pattern Sets (number & logic) ---
const g35PatternSets = [
  { seq: ['2','4','6','8','?'], answer: '10', choices: ['9','10','11','12'], display: 'number' },
  { seq: ['1','3','5','7','?'], answer: '9', choices: ['8','9','10','11'], display: 'number' },
  { seq: ['3','6','9','12','?'], answer: '15', choices: ['13','14','15','16'], display: 'number' },
  { seq: ['1','4','9','16','?'], answer: '25', choices: ['20','24','25','30'], display: 'number' },
  { seq: ['2','4','8','16','?'], answer: '32', choices: ['24','28','32','36'], display: 'number' },
  { seq: ['üî∑','üî∂','üî∑','üî∑','üî∂','üî∑','üî∑','üî∑','?'], answer: 'üî∂', choices: ['üî∑','üî∂','üî∏','üîπ'] },
  { seq: ['A','C','E','G','?'], answer: 'I', choices: ['H','I','J','K'], display: 'letter' },
  { seq: ['Z','X','V','T','?'], answer: 'R', choices: ['S','R','Q','P'], display: 'letter' },
];

// --- 3-5 Sorting Categories ---
const g35SortSets = [
  {
    instruction: 'Sort these into the right category!',
    buckets: ['Living Things', 'Non-Living Things'],
    items: [
      { text: 'üå≤ Tree', bucket: 0 },
      { text: 'ü™® Rock', bucket: 1 },
      { text: 'üêï Dog', bucket: 0 },
      { text: 'üíß Water', bucket: 1 },
      { text: 'üåª Flower', bucket: 0 },
      { text: 'ü™ë Chair', bucket: 1 },
    ]
  },
  {
    instruction: 'Sort these into the right category!',
    buckets: ['Even Numbers', 'Odd Numbers'],
    items: [
      { text: '7', bucket: 1 },
      { text: '12', bucket: 0 },
      { text: '15', bucket: 1 },
      { text: '8', bucket: 0 },
      { text: '23', bucket: 1 },
      { text: '44', bucket: 0 },
    ]
  },
  {
    instruction: 'Sort these into the right category!',
    buckets: ['Mammals', 'Reptiles'],
    items: [
      { text: 'üê∂ Dog', bucket: 0 },
      { text: 'üêç Snake', bucket: 1 },
      { text: 'üê± Cat', bucket: 0 },
      { text: 'ü¶é Lizard', bucket: 1 },
      { text: 'üê¨ Dolphin', bucket: 0 },
      { text: 'üêä Crocodile', bucket: 1 },
    ]
  },
  {
    instruction: 'Sort these into the right category!',
    buckets: ['Solids', 'Liquids'],
    items: [
      { text: 'üßä Ice', bucket: 0 },
      { text: 'üíß Water', bucket: 1 },
      { text: 'ü™® Rock', bucket: 0 },
      { text: 'ü•õ Milk', bucket: 1 },
      { text: 'üì± Phone', bucket: 0 },
      { text: 'üçØ Honey', bucket: 1 },
    ]
  },
];

// --- 3-5 Odd One Out ---
const g35OddSets = [
  { items: ['Mars','Earth','Jupiter','Sun'], odd: 'Sun', hint: 'One is a star, not a planet!' },
  { items: ['16','25','33','49'], odd: '33', hint: 'One is NOT a perfect square!' },
  { items: ['Noun','Verb','Adjective','Paragraph'], odd: 'Paragraph', hint: 'One is NOT a part of speech!' },
  { items: ['Triangle','Square','Circle','Cube'], odd: 'Cube', hint: 'One is a 3D shape!' },
  { items: ['Heart','Lungs','Bicycle','Brain'], odd: 'Bicycle', hint: 'One is NOT a body organ!' },
];

// ====== UTILITY ======
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function pick(arr, n) {
  return shuffle(arr).slice(0, n);
}

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ====== TIMER ======
function startTimer() {
  startTime = Date.now();
  elapsedSeconds = 0;
  timerInterval = setInterval(() => {
    elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
    const m = Math.floor(elapsedSeconds / 60);
    const s = elapsedSeconds % 60;
    document.getElementById('time-val').textContent = `${m}:${String(s).padStart(2, '0')}`;
  }, 500);
}

function stopTimer() {
  clearInterval(timerInterval);
}

function formatTime(sec) {
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${m}:${String(s).padStart(2, '0')}`;
}

// ====== FEEDBACK ======
function showFeedback(correct) {
  const toast = document.getElementById('feedback-toast');
  toast.className = 'feedback-toast ' + (correct ? 'correct-toast' : 'wrong-toast');
  const emojis = correct ? ['üéâ','‚≠ê','üåü','üôå','üí™'] : ['ü§î','üí≠','üßê','üëÄ'];
  const messages = correct
    ? ['Awesome!','Great Job!','Nailed It!','You Got It!','Brilliant!']
    : ['Not Quite!','Try Again!','Almost!','Keep Going!'];
  const idx = Math.floor(Math.random() * messages.length);
  toast.innerHTML = `<span class="toast-emoji">${emojis[idx]}</span>${messages[idx]}`;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 1200);
}

function updateScore(pts) {
  score += pts;
  document.getElementById('score-val').textContent = score;
}

function updateStars() {
  const stars = document.querySelectorAll('#stars-display .star');
  const pct = score / (totalRounds * 10);
  const earned = pct >= 0.9 ? 3 : pct >= 0.6 ? 2 : pct >= 0.3 ? 1 : 0;
  stars.forEach((s, i) => {
    if (i < earned) s.classList.add('earned');
    else s.classList.remove('earned');
  });
}

// ====== CONFETTI ======
function launchConfetti() {
  const container = document.getElementById('confetti-container');
  container.innerHTML = '';
  const colors = ['#FF6B6B','#FFD93D','#6BC5FF','#6BCB77','#9B72CF','#FFB085','#FF8FAB'];
  for (let i = 0; i < 60; i++) {
    const piece = document.createElement('div');
    piece.className = 'confetti-piece';
    piece.style.left = Math.random() * 100 + '%';
    piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    piece.style.width = (Math.random() * 8 + 5) + 'px';
    piece.style.height = (Math.random() * 8 + 5) + 'px';
    piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
    piece.style.animationDuration = (Math.random() * 2 + 2) + 's';
    piece.style.animationDelay = (Math.random() * 1.5) + 's';
    container.appendChild(piece);
  }
  setTimeout(() => container.innerHTML = '', 5000);
}

// ====== BUILD PUZZLES ======
function buildPuzzles() {
  puzzles = [];
  if (level === 'k2') {
    // 2 patterns, 1 odd-one-out, 1 memory match, 1 pattern
    const patterns = pick(k2PatternSets, 3);
    const odds = pick(k2OddSets, 1);
    puzzles.push({ type: 'pattern-k2', data: patterns[0] });
    puzzles.push({ type: 'odd-k2', data: odds[0] });
    puzzles.push({ type: 'memory', data: null });
    puzzles.push({ type: 'pattern-k2', data: patterns[1] });
    puzzles.push({ type: 'pattern-k2', data: patterns[2] });
  } else {
    // 2 patterns, 1 sorting, 1 odd-one-out, 1 pattern
    const patterns = pick(g35PatternSets, 3);
    const sorts = pick(g35SortSets, 1);
    const odds = pick(g35OddSets, 1);
    puzzles.push({ type: 'pattern-35', data: patterns[0] });
    puzzles.push({ type: 'sort', data: sorts[0] });
    puzzles.push({ type: 'odd-35', data: odds[0] });
    puzzles.push({ type: 'pattern-35', data: patterns[1] });
    puzzles.push({ type: 'pattern-35', data: patterns[2] });
  }
}

// ====== RENDER PUZZLES ======
function renderRound() {
  if (currentRound >= totalRounds) {
    endGame();
    return;
  }

  locked = false;
  document.getElementById('round-label').textContent = `Round ${currentRound + 1} / ${totalRounds}`;
  const puzzle = puzzles[currentRound];
  const area = document.getElementById('puzzle-area');
  area.innerHTML = '';

  switch (puzzle.type) {
    case 'pattern-k2':
    case 'pattern-35':
      renderPattern(puzzle);
      break;
    case 'odd-k2':
      renderOddK2(puzzle);
      break;
    case 'odd-35':
      renderOdd35(puzzle);
      break;
    case 'memory':
      renderMemory();
      break;
    case 'sort':
      renderSort(puzzle);
      break;
  }
}

// --- Pattern Puzzle ---
function renderPattern(puzzle) {
  const d = puzzle.data;
  document.getElementById('puzzle-title').textContent = 'What comes next?';
  document.getElementById('puzzle-desc').textContent = 'Look at the pattern and pick the missing piece!';

  const area = document.getElementById('puzzle-area');
  const isNumber = d.display === 'number' || d.display === 'letter';

  const colors = ['#FFE0E0','#FFF3D0','#D0F0FF','#E0FFE0','#F0E0FF','#FFE0F0','#FFF0D0','#E0F0FF','#FFD0E0'];

  let html = '<div class="pattern-game">';
  html += '<div class="pattern-sequence">';
  d.seq.forEach((item, i) => {
    const isLast = i === d.seq.length - 1 && item === '?';
    if (isLast || item === '?') {
      html += `<div class="pattern-item question-mark" style="animation-delay:${i * 0.1}s">?</div>`;
    } else {
      const bg = isNumber ? colors[i % colors.length] : 'transparent';
      html += `<div class="pattern-item" style="animation-delay:${i * 0.1}s; background:${bg}; ${isNumber ? 'font-family:Baloo 2,cursive;' : ''}">${item}</div>`;
    }
    if (i < d.seq.length - 1) html += '<span class="pattern-arrow">‚Üí</span>';
  });
  html += '</div>';

  html += '<div class="answer-choices">';
  const shuffled = shuffle(d.choices);
  shuffled.forEach(c => {
    html += `<button class="answer-btn" onclick="checkPatternAnswer(this, '${c}', '${d.answer}')" style="${isNumber ? 'font-family:Baloo 2,cursive; font-size:1.6rem;' : ''}">${c}</button>`;
  });
  html += '</div></div>';
  area.innerHTML = html;
}

function checkPatternAnswer(btn, selected, correct) {
  if (locked) return;
  locked = true;
  if (selected === correct) {
    btn.classList.add('correct');
    showFeedback(true);
    updateScore(10);
    updateStars();
  } else {
    btn.classList.add('wrong');
    showFeedback(false);
    // highlight correct
    document.querySelectorAll('.answer-btn').forEach(b => {
      if (b.textContent === correct) b.classList.add('correct');
    });
  }
  setTimeout(() => { currentRound++; renderRound(); }, 1500);
}

// --- Odd One Out K2 ---
function renderOddK2(puzzle) {
  const d = puzzle.data;
  document.getElementById('puzzle-title').textContent = 'Odd One Out!';
  document.getElementById('puzzle-desc').textContent = d.hint;

  const area = document.getElementById('puzzle-area');
  const shuffled = shuffle(d.items);
  let html = '<div class="odd-grid">';
  shuffled.forEach(item => {
    html += `<div class="odd-card" onclick="checkOdd(this, '${item}', '${d.odd}')">${item}</div>`;
  });
  html += '</div>';
  area.innerHTML = html;
}

// --- Odd One Out 3-5 ---
function renderOdd35(puzzle) {
  const d = puzzle.data;
  document.getElementById('puzzle-title').textContent = 'Odd One Out!';
  document.getElementById('puzzle-desc').textContent = d.hint;

  const area = document.getElementById('puzzle-area');
  const shuffled = shuffle(d.items);
  let html = '<div class="odd-grid">';
  shuffled.forEach(item => {
    html += `<div class="odd-card" onclick="checkOdd(this, '${item.replace(/'/g, "\\'")}', '${d.odd.replace(/'/g, "\\'")}')" style="font-size:1.4rem; font-family:'Baloo 2',cursive; font-weight:700;">${item}</div>`;
  });
  html += '</div>';
  area.innerHTML = html;
}

function checkOdd(card, selected, correct) {
  if (locked) return;
  locked = true;
  if (selected === correct) {
    card.classList.add('correct');
    showFeedback(true);
    updateScore(10);
    updateStars();
  } else {
    card.classList.add('wrong');
    showFeedback(false);
    document.querySelectorAll('.odd-card').forEach(c => {
      if (c.textContent === correct) c.classList.add('correct');
    });
  }
  setTimeout(() => { currentRound++; renderRound(); }, 1500);
}

// --- Memory Match ---
function renderMemory() {
  document.getElementById('puzzle-title').textContent = 'Memory Match!';
  document.getElementById('puzzle-desc').textContent = 'Find all the matching pairs!';

  const emojis = pick(k2MemoryEmojis, 6);
  const cards = shuffle([...emojis, ...emojis]);
  const area = document.getElementById('puzzle-area');

  let html = '<div class="memory-grid grid-3x4">';
  cards.forEach((emoji, i) => {
    html += `
      <div class="memory-card" data-emoji="${emoji}" data-index="${i}" onclick="flipCard(this)">
        <div class="memory-card-inner">
          <div class="memory-front">?</div>
          <div class="memory-back">${emoji}</div>
        </div>
      </div>`;
  });
  html += '</div>';
  area.innerHTML = html;

  window._memoryState = { flipped: [], matched: 0, total: 6, attempts: 0 };
}

function flipCard(card) {
  const state = window._memoryState;
  if (locked) return;
  if (card.classList.contains('flipped') || card.classList.contains('matched')) return;
  if (state.flipped.length >= 2) return;

  card.classList.add('flipped');
  state.flipped.push(card);

  if (state.flipped.length === 2) {
    state.attempts++;
    locked = true;
    const [a, b] = state.flipped;
    if (a.dataset.emoji === b.dataset.emoji) {
      setTimeout(() => {
        a.classList.add('matched');
        b.classList.add('matched');
        state.matched++;
        state.flipped = [];
        locked = false;
        if (state.matched === state.total) {
          // Score based on efficiency
          const efficiency = state.total / state.attempts;
          const pts = efficiency >= 0.8 ? 10 : efficiency >= 0.5 ? 7 : 5;
          showFeedback(true);
          updateScore(pts);
          updateStars();
          setTimeout(() => { currentRound++; renderRound(); }, 1200);
        }
      }, 500);
    } else {
      setTimeout(() => {
        a.classList.remove('flipped');
        b.classList.remove('flipped');
        state.flipped = [];
        locked = false;
      }, 900);
    }
  }
}

// --- Sorting Game ---
function renderSort(puzzle) {
  const d = puzzle.data;
  document.getElementById('puzzle-title').textContent = d.instruction;
  document.getElementById('puzzle-desc').textContent = 'Tap an item, then tap the bucket it belongs in!';

  const items = shuffle(d.items);
  const area = document.getElementById('puzzle-area');

  let html = '<div class="sorting-game">';
  html += '<div class="sort-items" id="sort-items">';
  items.forEach((item, i) => {
    html += `<div class="sort-item" data-idx="${i}" data-bucket="${item.bucket}" onclick="selectSortItem(this)">${item.text}</div>`;
  });
  html += '</div>';

  html += '<div class="sort-buckets">';
  d.buckets.forEach((name, i) => {
    html += `<div class="sort-bucket" data-bucket="${i}" onclick="placeSortItem(this)">
      <div class="bucket-title">${name}</div>
      <div class="bucket-items" id="bucket-items-${i}"></div>
    </div>`;
  });
  html += '</div></div>';
  area.innerHTML = html;

  window._sortState = {
    selected: null,
    placed: 0,
    total: items.length,
    correctCount: 0,
  };
}

function selectSortItem(el) {
  if (el.classList.contains('placed')) return;
  document.querySelectorAll('.sort-item').forEach(e => e.classList.remove('selected'));
  el.classList.add('selected');
  window._sortState.selected = el;
}

function placeSortItem(bucket) {
  const state = window._sortState;
  if (!state.selected) return;

  const item = state.selected;
  const correctBucket = parseInt(item.dataset.bucket);
  const targetBucket = parseInt(bucket.dataset.bucket);
  const isCorrect = correctBucket === targetBucket;

  const chip = document.createElement('div');
  chip.className = 'bucket-chip ' + (isCorrect ? 'correct-chip' : 'wrong-chip');
  chip.textContent = item.textContent;
  bucket.querySelector('.bucket-items').appendChild(chip);

  item.classList.remove('selected');
  item.classList.add('placed');

  if (isCorrect) state.correctCount++;
  state.placed++;
  state.selected = null;

  if (state.placed === state.total) {
    const pct = state.correctCount / state.total;
    const pts = pct >= 0.9 ? 10 : pct >= 0.7 ? 7 : pct >= 0.4 ? 4 : 2;
    showFeedback(pct >= 0.7);
    updateScore(pts);
    updateStars();
    setTimeout(() => { currentRound++; renderRound(); }, 1500);
  }
}

// ====== GAME FLOW ======
function startGame(lv) {
  level = lv;
  currentRound = 0;
  score = 0;
  document.getElementById('score-val').textContent = '0';
  document.querySelectorAll('#stars-display .star').forEach(s => s.classList.remove('earned'));
  buildPuzzles();
  showScreen('game-screen');
  startTimer();
  renderRound();
}

function endGame() {
  stopTimer();
  const pct = score / (totalRounds * 10);
  const starCount = pct >= 0.9 ? 3 : pct >= 0.6 ? 2 : pct >= 0.3 ? 1 : 0;

  // Results
  const emojis = ['üòä','üåü','üèÜ','üëë'];
  const headings = ['Good Effort!','Nice Work!','Amazing Job!','You\'re a Star!'];
  const messages = [
    'Every puzzle makes your brain stronger! Try again to earn more stars.',
    'You\'re building great thinking skills! Keep it up!',
    'Your critical thinking is on fire! Incredible work!',
    'Perfect score! You\'re a true BrainBuilder champion!'
  ];

  document.getElementById('results-emoji').textContent = emojis[starCount];
  document.getElementById('results-heading').textContent = headings[starCount];
  document.getElementById('results-score').textContent = score;
  document.getElementById('results-time').textContent = formatTime(elapsedSeconds);
  document.getElementById('results-message').textContent = messages[starCount];

  const starsHtml = Array(3).fill(0).map((_, i) =>
    `<span class="star ${i < starCount ? 'earned' : ''}" style="animation-delay:${i * 0.2}s">‚≠ê</span>`
  ).join('');
  document.getElementById('results-stars').innerHTML = starsHtml;

  showScreen('results-screen');
  if (starCount >= 2) launchConfetti();
}

function goHome() {
  stopTimer();
  showScreen('welcome-screen');
}

function playAgain() {
  startGame(level);
}
</script>
</body>
</html>